<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ågotnes Legekontor</title>
  <link rel="icon" type="image/png" href="favicon.png">
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
  line-height: 1.6;
  color: #222;
}
  #forsidebilde-container img {
  width: 100%;
  max-height: 450px;
  object-fit: cover;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  display: block;
}
header {
  text-align: center;
  margin-bottom: 2rem;
}
h1 {
  font-size: 2em;
  margin-bottom: 0.2em;
}
h2 {
  border-bottom: 2px solid #ccc;
  padding-bottom: 4px;
  color: #005fa3;
}
ul {
  list-style: none;
  padding-left: 0;
}
li::before {
  content: "• ";
  color: #005fa3;
}
footer {
  text-align: center;
  font-size: 0.9em;
  color: gray;
  margin-top: 3rem;
  border-top: 1px solid #ddd;
  padding-top: 1rem;
}
  #chatbot-container {
  max-width: 350px;
  margin: 1.5rem auto;
  padding: 1rem;
  background: #f8f9fa;
  border: 1px solid #ccc;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  font-family: sans-serif;
}

#chatbot-container h3 {
  margin-top: 0;
  color: #004b87;
  font-size: 1.1rem;
  text-align: center;
}

#chatlog {
  max-height: 180px;
  overflow-y: auto;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

#chatlog .bruker { text-align: right; color: #0056b3; margin: 4px 0; }
#chatlog .bot { text-align: left; color: #333; margin: 4px 0; }

#brukerInput {
  width: 100%;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

</style>
</head>
<body>

<header style="
  position: relative;
  background: white;
  color: black;
  text-align: center;
  padding: 3rem 1rem 2rem 1rem;
  font-family: 'Segoe UI', Helvetica, Arial, sans-serif;
  overflow: hidden;
">
  <!-- Subtil gradient nederst -->
  <div style="
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    pointer-events: none;
  "></div>

  <div style="max-width: 900px; margin: auto; position: relative; z-index: 2;">
    <h1 id="kontornavn" style="
      font-size: 3rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      letter-spacing: 0.4px;
    "></h1>
    <p style="
      font-size: 1.25rem;
      font-weight: 300;
      margin: 0;
      color: #444;
    ">
      Informasjon til pasienter og besøkende
    </p>
  </div>
</header>

<!-- Forsidebilde-container -->
<div id="forsidebilde-container" style="text-align:center; margin:0; padding:0;"></div>

<!-- Midlertidige meldinger (vises kun ved aktive perioder) -->
<div id="midlertidig-info" style="
  display:none;
  opacity:0;
  background:#f1f9fb;
  border:1px solid #cbe3e8;
  color:#084a5d;
  text-align:center;
  padding:1.2rem;
  margin:2rem auto;
  border-radius:8px;
  max-width:850px;
  font-family:'Segoe UI', Helvetica, Arial, sans-serif;
  box-shadow:0 1px 3px rgba(0,0,0,0.05);
  transition:opacity 0.5s ease;
"></div>

  
<section>
  <h2>Kontakt oss</h2>
  <p id="Kontakt_oss"></p>
</section>

<div id="chatbot-container">
  <h3>Lurer du på noe?</h3>
  <p style="text-align:center; margin-top:0; font-size:0.9rem; color:#333;">
    Chatboten kan svare på vanlige spørsmål om time, resepter og åpningstider – så slipper du kanskje å stå i telefonkø -under utvikling-.
  </p>
  <div id="chatlog"></div>
  <input id="brukerInput" type="text" placeholder="Skriv et spørsmål..." />
</div>

  
<section>
  <h2>Åpningstider</h2>
  <p id="aapningstider"></p>
</section>

  <section>
  <h2>Laboratoriet</h2>
  <p id="labinfo"></p>
</section>
  
<section>
  <h2>Ventetid</h2>
  <p id="ventetid"></p>
</section>

<section>
  <h2>Leger</h2>
  <ul id="leger"></ul>
</section>

<section>
  <h2>Priser og attester</h2>
  <ul id="priser"></ul>
</section>

<section>
  <h2>Helsenorge-tjenester</h2>
  <ul id="helsenorge"></ul>
</section>

<section style="margin-top:3rem; padding:1.5rem; background:#f9fafb; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08);">
  <h2 style="text-align:center; color:#005fa3;">Finn oss</h2>
  <p style="text-align:center; margin-bottom:1rem;">
    Ågotnes Legekontor ligger i Ågotnes Helsebygg, Skjergardsvegen 1376 – Øygarden kommune.<br>
    Parkering finnes rett utenfor bygget.
  </p>

  <iframe 
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1970.5655196183056!2d4.998993777259965!3d60.402853724632386!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x463ce136f2ab961f%3A0x74ba0045a0ed2563!2s%C3%85gotnes%20Legekontor!5e0!3m2!1sno!2sno!4v1761066486378!5m2!1sno!2sno" 
    width="100%" 
    height="350" 
    style="border:0; border-radius:10px;" 
    allowfullscreen="" 
    loading="lazy" 
    referrerpolicy="no-referrer-when-downgrade">
  </iframe>

  <p style="text-align:center; margin-top:0.5rem;">
    <a href="https://www.google.com/maps?daddr=Skjergardsvegen+1376,+5363+Ågotnes" target="_blank" rel="noopener">
      Åpne veibeskrivelse i Google Maps
    </a>
  </p>
</section>

<!-- Blå overgang før footer -->
<hr style="border:none; border-top:3px solid #005fa3; width:60px; margin:2rem auto;">


<footer>
  © <span id="year"></span> Ågotnes Legekontor – Øygarden kommune
</footer>

<script>
fetch('innhold.json')
  .then(res => res.json())
  .then(data => {
    document.getElementById('kontornavn').textContent = data.kontornavn;
    document.getElementById('aapningstider').innerHTML =
      `<strong>Legekontor:</strong> ${data.aapningstider.legekontor}<br>
       <strong>Telefon:</strong> ${data.aapningstider.telefon}<br>
       <strong>Laboratorium:</strong> ${data.aapningstider.laboratorium}`;
    document.getElementById('ventetid').textContent = data.ventetid;
    document.getElementById('leger').innerHTML = data.leger.map(l => `<li>${l}</li>`).join('');
       // Sett inn faste deler av innholdet fra JSON
    document.getElementById('labinfo').textContent = data.labinfo;
    document.getElementById('priser').innerHTML = data.priser.map(p => `<li>${p}</li>`).join('');
    document.getElementById('helsenorge').innerHTML = data.helsenorge.map(h => `<li>${h}</li>`).join('');
    document.getElementById('year').textContent = new Date().getFullYear();
   document.getElementById('Kontakt_oss').innerHTML =
  `<strong>Resepsjon:</strong> ${data.Kontakt_oss.Resepsjon}<br>
   <strong>Adresse:</strong> ${data.Kontakt_oss.Adresse}`;


    // ---- Legg til forsidebilde hvis definert i JSON ----
    if (data.forsidebilde) {
      const container = document.getElementById("forsidebilde-container");
      const img = document.createElement("img");
      img.src = data.forsidebilde;
      img.alt = "Bilde fra legekontoret";
img.removeAttribute("style"); // lar CSS gjøre jobben
      container.appendChild(img);
    }

    // ---- Viser midlertidige meldinger (fra data.midlertidige_meldinger) ----
    if (data.midlertidige_meldinger && Array.isArray(data.midlertidige_meldinger)) {
      const idag = new Date();
      const aktiveMeldinger = data.midlertidige_meldinger.filter(m => {
        const start = new Date(m.start);
        const slutt = new Date(m.slutt);
        return idag >= start && idag <= slutt;
      });

      if (aktiveMeldinger.length > 0) {
        const felt = document.getElementById('midlertidig-info');
        felt.innerHTML = aktiveMeldinger.map(m => `<p style="margin:0.4rem 0;">${m.tekst}</p>`).join('');
        felt.style.display = "block";
        requestAnimationFrame(() => {
          felt.style.opacity = "1";
        });
      }
    }
  })  // slutt på .then(data => { ... })
  .catch((err) => {
    console.error("Feil ved lasting av JSON:", err);
    document.body.innerHTML = "<p>Kunne ikke laste innholdet. Sjekk at innhold.json ligger i samme mappe som index.html.</p>";
  });
// --- Chatbot-funksjon med fuzzy matching og kontekstregler ---
let chatbotMaler = [];
let kontekstregler = [];

// Synonymer for bedre treff
const synonymer = {
  "time": ["konsultasjon", "avtale", "avtal", "book", "timebestilling", "legebesøk"],
  "bestill": ["avtal", "book", "reserver", "skaff", "ordne"],
  "lege": ["legekontor", "doktor", "legen"],
  "åpningstid": ["åpent", "tid", "når", "åpning", "stengt"],
  "resept": ["forny", "medisin", "legemiddel", "tablett", "kur"],
  "kontakt": ["ringe", "telefon", "nummer", "adresse"]
};

// Fuzzy matching med Levenshtein-avstand
function levenshtein(a, b) {
  const m = [];
  for (let i = 0; i <= b.length; i++) m[i] = [i];
  for (let j = 0; j <= a.length; j++) m[0][j] = j;
  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      m[i][j] = b[i - 1] === a[j - 1]
        ? m[i - 1][j - 1]
        : Math.min(m[i - 1][j - 1] + 1, m[i][j - 1] + 1, m[i - 1][j] + 1);
    }
  }
  return m[b.length][a.length];
}

// Kombinert matcher: eksakt + fuzzy + synonymer
function matcher(ord, tekst) {
  const alle = [ord, ...(synonymer[ord] || [])];
  return alle.some(o => {
    if (tekst.includes(o)) return true;
    const ordtekst = tekst.split(/\s+/);
    return ordtekst.some(t => levenshtein(t, o) <= 2);
  });
}

// Last inn maler og eventuelle kontekstregler
fetch("innhold.json")
  .then(r => r.json())
  .then(data => {
    chatbotMaler = data.chatbot_maler || [];
    kontekstregler = data.kontekstregler || [];
  });

const input = document.getElementById("brukerInput");
const chatlog = document.getElementById("chatlog");

if (input && chatlog) {
  input.addEventListener("keypress", e => {
    if (e.key === "Enter" && input.value.trim() !== "") {
      const spm = input.value.trim().toLowerCase();
      chatlog.innerHTML += `<div class="bruker">${spm}</div>`;
      input.value = "";

      let besteTreff = null;
      let høyesteScore = 0;

      // --- Beregn grunnscore ---
      for (let mal of chatbotMaler) {
        let score = 0;
        for (let ord of mal.nøkkelord) {
          const alle = [ord, ...(synonymer[ord] || [])];
          for (let o of alle) {
  if (spm.includes(o)) score += 3; // eksakt match i brukerens spørsmål
  else if (mal.svar.toLowerCase().includes(o)) score += 0.5; // svak match i svaret
  else {
    const ordtekst = spm.split(/\s+/);
    for (let t of ordtekst) {
      const dist = levenshtein(t, o);
      if (dist === 1) score += 1.5; // nesten riktig (fuzzy)
      else if (dist === 2) score += 1; // små skrivefeil
    }
  }
}
        }
        mal._score = score;
      }

      // --- Påfør kontekstregler fra JSON ---
      for (let regel of kontekstregler) {
        const oppfyllt = regel.hvis.every(w => spm.includes(w));
        if (oppfyllt) {
          for (let mal of chatbotMaler) {
            if (regel.styrk && mal.nøkkelord.includes(regel.styrk)) mal._score += 2;
            if (regel.svekk && mal.nøkkelord.includes(regel.svekk)) mal._score -= 1;
          }
        }
      }

      // --- Finn beste treff ---
// --- Finn beste treff ---
for (let mal of chatbotMaler) {
  if (mal._score > høyesteScore) {
    høyesteScore = mal._score;
    besteTreff = mal;
  }
}

console.log("Endelig beste treff:", besteTreff?.nøkkelord, "score:", høyesteScore);

// --- 🔍 Sikkerhetsfiltrering mot tilfeldige treff ---
// Denne sjekken sørger for at spørsmålet faktisk inneholder
// minst ett ekte nøkkelord fra JSON, ikke bare fuzzy-likhet.
const harTreff = chatbotMaler.some(m =>
  m.nøkkelord.some(o => spm.toLowerCase().includes(o.toLowerCase()))
);
// --- Finn og sorter treff etter score ---
const sorterte = chatbotMaler
  .filter(m => m._score && m._score > 0)
  .sort((a,b) => b._score - a._score);

const besteTreff = sorterte[0] || null;
const nestBeste = sorterte[1] || null;

// --- Gi svar eller fallback ---
if (besteTreff && besteTreff._score >= 3 && harTreff) {
  chatlog.innerHTML += `
    <div class="bot">
      ${besteTreff.svar}
      ${nestBeste && nestBeste._score >= 2 ? `
        <button onclick="visAlternativSvar()" style="
          margin-top:6px; background:#e7f0fa; border:1px solid #bcd3ec;
          color:#004b87; border-radius:6px; padding:3px 6px; cursor:pointer;
          font-size:0.8rem;">Vis alternativt svar</button>` : ""}
    </div>`;
  window.nestBeste = nestBeste;
} else {
  chatlog.innerHTML += `<div class="bot">Beklager, det spørsmålet forstår jeg ikke helt. Prøv gjerne igjen.</div>`;
}

chatlog.scrollTop = chatlog.scrollHeight;

// --- Funksjon for å vise alternativt svar ---
function visAlternativSvar() {
  if (window.nestBeste) {
    chatlog.innerHTML += `<div class="bot" style="opacity:0.85; font-style:italic;">
      (Alternativt svar:) ${window.nestBeste.svar}
    </div>`;
    chatlog.scrollTop = chatlog.scrollHeight;
  } else {
    alert("Ingen alternativt svar funnet.");
  }
}
  }); // avslutter keypress-listener
</script>
</body>
</html>





























